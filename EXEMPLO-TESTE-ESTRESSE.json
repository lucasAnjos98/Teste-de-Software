// Exemplo de Teste de Estresse com Artillery
// Configuração para testar limites do sistema BookShare

{
  "config": {
    "target": "http://localhost:3000",
    "phases": [
      {
        "duration": 30,
        "arrivalRate": 1,
        "name": "Baseline"
      },
      {
        "duration": 60,
        "arrivalRate": 10,
        "name": "Normal Load"
      },
      {
        "duration": 30,
        "arrivalRate": 50,
        "name": "High Load"
      },
      {
        "duration": 60,
        "arrivalRate": 100,
        "name": "Peak Load"
      },
      {
        "duration": 120,
        "arrivalRate": 200,
        "name": "Stress Test"
      },
      {
        "duration": 30,
        "arrivalRate": 500,
        "name": "Breakpoint Test"
      }
    ]
  },
  "scenarios": [
    {
      "name": "Concurrent Book Registration",
      "weight": 30,
      "flow": [
        {
          "post": {
            "url": "/api/books",
            "json": {
              "title": "Livro Estresse {{ $randomString() }}",
              "author": "Autor Estresse {{ $randomString() }}",
              "description": "Descrição para teste de estresse com mais caracteres para testar limites do sistema e validação de campos longos e complexos"
            }
          }
        }
      ]
    },
    {
      "name": "Rapid Book Search",
      "weight": 25,
      "flow": [
        {
          "get": {
            "url": "/api/books?search={{ $randomString() }}&limit={{ $randomInt(10, 100) }}"
          }
        }
      ]
    },
    {
      "name": "Borrow Book Storm",
      "weight": 25,
      "flow": [
        {
          "get": {
            "url": "/api/books?status=AVAILABLE&limit={{ $randomInt(1, 50) }}"
          }
        },
        {
          "think": "{{ $randomInt(100, 1000) }}"
        },
        {
          "post": {
            "url": "/api/borrow",
            "json": {
              "bookId": "book-{{ $randomInt(1, 1000) }}",
              "borrowerId": "user-{{ $randomInt(1, 5000) }}"
            }
          }
        }
      ]
    },
    {
      "name": "Authentication Flood",
      "weight": 20,
      "flow": [
        {
          "post": {
            "url": "/api/auth/login",
            "json": {
              "email": "stress{{ $randomInt(1, 10000) }}@test.com",
              "password": "{{ $randomString() }}"
            }
          }
        }
      ]
    }
  ],
  "processor": {
    "env": {
      "ARTILLERY_UNIQUE_USERS": 10000,
      "ARTILLERY_DISALLOWED_NAMES": ["admin", "root", "system"]
    }
  }
}